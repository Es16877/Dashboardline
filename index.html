<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Izin Keluar</title>
    <style>
        /* [CSS sebelumnya tetap sama] */
        .counter-container {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            text-align: center;
        }
        .counter-box {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            width: 22%;
        }
        .counter-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <!-- [HTML sebelumnya tetap sama] -->

    <script>
        // Data akan disimpan di localStorage
        const saveData = () => {
            localStorage.setItem('staffData', JSON.stringify(staffData));
            localStorage.setItem('exitRecords', JSON.stringify(exitRecords));
            localStorage.setItem('currentlyOut', JSON.stringify(currentlyOut));
            if(currentUser) localStorage.setItem('currentUser', JSON.stringify(currentUser));
        };

        // Load data dari localStorage
        const loadData = () => {
            const savedStaff = localStorage.getItem('staffData');
            const savedRecords = localStorage.getItem('exitRecords');
            const savedOut = localStorage.getItem('currentlyOut');
            const savedUser = localStorage.getItem('currentUser');
            
            if(savedStaff) staffData = JSON.parse(savedStaff);
            if(savedRecords) exitRecords = JSON.parse(savedRecords);
            if(savedOut) currentlyOut = JSON.parse(savedOut);
            if(savedUser) currentUser = JSON.parse(savedUser);
        };

        // Auto-login jika sudah login sebelumnya
        const checkAutoLogin = () => {
            loadData();
            if(currentUser && currentUser.position !== 'admin') {
                document.getElementById('login-page').classList.add('hidden');
                document.getElementById('main-page').classList.remove('hidden');
                updateCurrentlyOutList();
                checkExitButtonStatus();
                updateCounters();
            }
        };

        // Fungsi untuk update counter
        const updateCounters = () => {
            const kasirOut = currentlyOut.filter(s => s.position === 'kasir').length;
            const csOut = currentlyOut.filter(s => s.position === 'cs').length;
            const khemerOut = currentlyOut.filter(s => s.position === 'khemer').length;
            
            document.getElementById('counter-kasir').textContent = kasirOut;
            document.getElementById('counter-cs').textContent = csOut;
            document.getElementById('counter-khemer').textContent = khemerOut;
        };

        // [Fungsi-fungsi sebelumnya tetap sama, tapi tambahkan saveData() di akhir setiap fungsi yang mengubah data]
        // Contoh di fungsi login:
        function login() {
            // ... kode sebelumnya
            if (user) {
                currentUser = user;
                saveData(); // <-- Tambahkan ini
                // ... kode setelahnya
            }
        }

        // Tambahkan counter dashboard di HTML (di dalam div.dashboard)
        const dashboardHTML = `
            <div class="counter-container">
                <div class="counter-box">
                    <div>Kasir Keluar</div>
                    <div class="counter-value" id="counter-kasir">0</div>
                    <div>Maks: 3 orang</div>
                </div>
                <div class="counter-box">
                    <div>CS Keluar</div>
                    <div class="counter-value" id="counter-cs">0</div>
                    <div>Maks: 3 orang</div>
                </div>
                <div class="counter-box">
                    <div>Khemer Keluar</div>
                    <div class="counter-value" id="counter-khemer">0</div>
                    <div>Maks: 1 orang</div>
                </div>
            </div>
        `;
        document.querySelector('.dashboard').insertAdjacentHTML('afterbegin', dashboardHTML);

        // Panggil checkAutoLogin saat halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            updateClock();
            checkAutoLogin();
            
            // Untuk admin, tetap harus login manual
            if(currentUser && currentUser.position === 'admin') {
                logout();
            }
        });

        // Modifikasi fungsi requestExit dan recordEntry untuk update counter
        function requestExit() {
            // ... kode sebelumnya
            updateCounters(); // <-- Tambahkan ini
            saveData();      // <-- Dan ini
        }

        function recordEntry() {
            // ... kode sebelumnya
            updateCounters(); // <-- Tambahkan ini
            saveData();      // <-- Dan ini
        }
    </script>
</body>
</html>
