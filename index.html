<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistem Izin Keluar | Modern</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --primary: #4361ee;
  --primary-light: #4895ef;
  --secondary: #3f37c9;
  --success: #4cc9f0;
  --danger: #f72585;
  --warning: #f8961e;
  --light: #f8f9fa;
  --dark: #212529;
  --gray: #6c757d;
  --white: #ffffff;
  --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  --transition: all 0.3s ease;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Poppins', sans-serif;
  background-color: #f5f7fa;
  color: var(--dark);
  line-height: 1.6;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

/* Login Page */
.login-page {
  display: flex;
  min-height: 100vh;
  background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
}

.login-container {
  display: flex;
  width: 100%;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
}

.login-box {
  background-color: var(--white);
  border-radius: 16px;
  box-shadow: var(--shadow);
  width: 100%;
  max-width: 450px;
  padding: 40px;
  position: relative;
  overflow: hidden;
  transition: var(--transition);
}

.login-box::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 8px;
  background: linear-gradient(90deg, var(--primary) 0%, var(--success) 100%);
}

.login-header {
  text-align: center;
  margin-bottom: 30px;
}

.login-header h1 {
  color: var(--primary);
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 10px;
}

.login-header p {
  color: var(--gray);
  font-size: 14px;
}

.login-logo {
  width: 80px;
  height: 80px;
  margin: 0 auto 20px;
  background-color: var(--primary-light);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 32px;
  box-shadow: var(--shadow);
}

.form-group {
  margin-bottom: 20px;
  position: relative;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: var(--dark);
  font-size: 14px;
}

.form-control {
  width: 100%;
  padding: 12px 15px;
  border: 2px solid #e9ecef;
  border-radius: 8px;
  font-size: 14px;
  transition: var(--transition);
  background-color: #f8f9fa;
}

.form-control:focus {
  outline: none;
  border-color: var(--primary);
  background-color: var(--white);
  box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
}

.input-icon {
  position: absolute;
  right: 15px;
  top: 38px;
  color: var(--gray);
}

.btn {
  display: inline-block;
  background-color: var(--primary);
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 500;
  width: 100%;
  transition: var(--transition);
  text-align: center;
  box-shadow: var(--shadow);
}

.btn:hover {
  background-color: var(--secondary);
  transform: translateY(-2px);
}

.btn:active {
  transform: translateY(0);
}

.btn-block {
  display: block;
  width: 100%;
}

.error-message {
  color: var(--danger);
  margin-top: 5px;
  font-size: 12px;
  display: none;
}

/* Dashboard */
.dashboard {
  display: none;
  min-height: 100vh;
}

/* Sidebar */
.sidebar {
  width: 250px;
  background-color: var(--white);
  box-shadow: var(--shadow);
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  padding: 20px 0;
  z-index: 100;
  transition: var(--transition);
}

.sidebar-header {
  padding: 0 20px 20px;
  border-bottom: 1px solid #e9ecef;
  margin-bottom: 20px;
}

.sidebar-header h3 {
  color: var(--primary);
  font-size: 18px;
  font-weight: 600;
  display: flex;
  align-items: center;
}

.sidebar-header h3 i {
  margin-right: 10px;
  color: var(--primary);
}

.sidebar-menu {
  list-style: none;
}

.sidebar-menu li a {
  display: flex;
  align-items: center;
  padding: 12px 20px;
  color: var(--dark);
  text-decoration: none;
  transition: var(--transition);
  border-left: 3px solid transparent;
}

.sidebar-menu li a:hover {
  background-color: #f8f9fa;
  border-left: 3px solid var(--primary);
  color: var(--primary);
}

.sidebar-menu li a.active {
  background-color: #f8f9fa;
  border-left: 3px solid var(--primary);
  color: var(--primary);
}

.sidebar-menu li a i {
  margin-right: 10px;
  width: 20px;
  text-align: center;
}

/* Main Content */
.main-content {
  margin-left: 250px;
  width: calc(100% - 250px);
  padding: 20px;
  transition: var(--transition);
}

/* Header */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 20px;
  background-color: var(--white);
  border-radius: 8px;
  box-shadow: var(--shadow);
  margin-bottom: 30px;
}

.page-title h2 {
  color: var(--dark);
  font-size: 22px;
  font-weight: 600;
}

.page-title p {
  color: var(--gray);
  font-size: 13px;
  margin-top: 5px;
}

.user-menu {
  display: flex;
  align-items: center;
}

.user-info {
  display: flex;
  align-items: center;
}

.user-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background-color: var(--primary-light);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 10px;
  font-weight: 600;
}

.user-name {
  font-weight: 500;
  margin-right: 10px;
}

.logout-btn {
  background-color: var(--danger);
  color: white;
  border: none;
  padding: 8px 15px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 13px;
  transition: var(--transition);
  display: flex;
  align-items: center;
}

.logout-btn:hover {
  background-color: #d1146a;
}

.logout-btn i {
  margin-right: 5px;
}

/* Cards */
.card {
  background-color: var(--white);
  border-radius: 10px;
  box-shadow: var(--shadow);
  padding: 20px;
  margin-bottom: 20px;
  transition: var(--transition);
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 1px solid #e9ecef;
}

.card-title {
  font-size: 18px;
  font-weight: 600;
  color: var(--dark);
  display: flex;
  align-items: center;
}

.card-title i {
  margin-right: 10px;
  color: var(--primary);
}

/* Form */
.form-row {
  display: flex;
  flex-wrap: wrap;
  margin: 0 -10px;
}

.form-col {
  flex: 0 0 50%;
  max-width: 50%;
  padding: 0 10px;
  margin-bottom: 15px;
}

@media (max-width: 768px) {
  .form-col {
    flex: 0 0 100%;
    max-width: 100%;
  }
}

/* Table */
.table-responsive {
  width: 100%;
  overflow-x: auto;
}

.table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
}

.table th {
  background-color: #f8f9fa;
  padding: 12px 15px;
  text-align: left;
  font-weight: 600;
  color: var(--dark);
  border-bottom: 2px solid #e9ecef;
}

.table td {
  padding: 12px 15px;
  border-bottom: 1px solid #e9ecef;
  vertical-align: middle;
}

.table tr:last-child td {
  border-bottom: none;
}

.table tr:hover {
  background-color: #f8f9fa;
}

.status-badge {
  display: inline-block;
  padding: 5px 10px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 500;
}

.status-pending {
  background-color: #fff3cd;
  color: #856404;
}

.status-approved {
  background-color: #d4edda;
  color: #155724;
}

.status-rejected {
  background-color: #f8d7da;
  color: #721c24;
}

.status-late {
  background-color: #ffe8cc;
  color: #e67e22;
}

.status-current {
  background-color: #d4e6f1;
  color: #2980b9;
}

.action-btn {
  background: none;
  border: none;
  cursor: pointer;
  margin: 0 5px;
  font-size: 14px;
  transition: var(--transition);
  width: 30px;
  height: 30px;
  border-radius: 50%;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.action-btn:hover {
  background-color: #f8f9fa;
}

.view-btn {
  color: var(--primary);
}

.edit-btn {
  color: var(--warning);
}

.delete-btn {
  color: var(--danger);
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}

.modal-content {
  background-color: var(--white);
  border-radius: 10px;
  width: 90%;
  max-width: 600px;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  animation: modalFadeIn 0.3s ease;
}

@keyframes modalFadeIn {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 20px;
  border-bottom: 1px solid #e9ecef;
}

.modal-title {
  font-size: 18px;
  font-weight: 600;
  color: var(--dark);
  display: flex;
  align-items: center;
}

.modal-title i {
  margin-right: 10px;
  color: var(--primary);
}

.close-btn {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: var(--gray);
  transition: var(--transition);
}

.close-btn:hover {
  color: var(--danger);
  transform: rotate(90deg);
}

.modal-body {
  padding: 20px;
}

.modal-footer {
  padding: 15px 20px;
  border-top: 1px solid #e9ecef;
  display: flex;
  justify-content: flex-end;
}

/* Tabs */
.tabs {
  display: flex;
  border-bottom: 1px solid #e9ecef;
  margin-bottom: 20px;
}

.tab {
  padding: 10px 20px;
  cursor: pointer;
  border-bottom: 3px solid transparent;
  transition: var(--transition);
}

.tab.active {
  border-bottom: 3px solid var(--primary);
  color: var(--primary);
  font-weight: 500;
}

.tab:hover:not(.active) {
  background-color: #f8f9fa;
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

/* Badges */
.badge {
  display: inline-block;
  padding: 3px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
}

.badge-primary {
  background-color: var(--primary-light);
  color: white;
}

.badge-warning {
  background-color: var(--warning);
  color: white;
}

.badge-danger {
  background-color: var(--danger);
  color: white;
}

/* Responsive */
@media (max-width: 992px) {
  .sidebar {
    width: 70px;
    overflow: hidden;
  }

  .sidebar-header h3 span,
  .sidebar-menu li a span {
    display: none;
  }

  .sidebar-menu li a {
    justify-content: center;
  }

  .sidebar-menu li a i {
    margin-right: 0;
    font-size: 18px;
  }

  .main-content {
    margin-left: 70px;
    width: calc(100% - 70px);
  }
}

@media (max-width: 768px) {
  .sidebar {
    transform: translateX(-100%);
  }

  .sidebar.active {
    transform: translateX(0);
  }

  .main-content {
    margin-left: 0;
    width: 100%;
  }

  .menu-toggle {
    display: block;
  }
}

/* Animation */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.fade-in {
  animation: fadeIn 0.5s ease forwards;
}

/* Stats */
.stats-container {
  display: flex;
  flex-wrap: wrap;
  margin: -10px;
}

.stat-card {
  flex: 1 1 200px;
  min-width: 200px;
  background-color: var(--white);
  border-radius: 8px;
  padding: 15px;
  margin: 10px;
  box-shadow: var(--shadow);
  text-align: center;
}

.stat-value {
  font-size: 24px;
  font-weight: 700;
  margin: 10px 0;
}

.stat-label {
  font-size: 14px;
  color: var(--gray);
}

/* Filter */
.filter-group {
  display: flex;
  margin-bottom: 20px;
  align-items: center;
}

.filter-group label {
  margin-right: 10px;
  font-weight: 500;
}

.filter-group select,
.filter-group input {
  padding: 8px 12px;
  border: 1px solid #e9ecef;
  border-radius: 4px;
  margin-right: 10px;
}

.filter-group button {
  padding: 8px 15px;
  background-color: var(--primary);
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.filter-group button:hover {
  background-color: var(--secondary);
}
</style>
</head>
<body>
<!-- Login Page -->
<div class="login-page" id="login-page">
  <div class="login-container">
    <div class="login-box fade-in">
      <div class="login-header">
        <div class="login-logo">
          <i class="fas fa-door-open"></i>
        </div>
        <h1>Sistem Izin Keluar</h1>
        <p>Silakan login untuk mengakses sistem</p>
      </div>

      <form id="loginForm">
        <div class="form-group">
          <label for="username">Username</label>
          <div class="input-wrapper">
            <input type="text" class="form-control" id="username" placeholder="Masukkan username" required>
            <i class="fas fa-user input-icon"></i>
          </div>
          <div class="error-message" id="username-error"></div>
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <div class="input-wrapper">
            <input type="password" class="form-control" id="password" placeholder="Masukkan password" required>
            <i class="fas fa-lock input-icon"></i>
          </div>
          <div class="error-message" id="password-error"></div>
        </div>

        <button type="submit" class="btn btn-block">
          <i class="fas fa-sign-in-alt"></i> Login
        </button>
      </form>
    </div>
  </div>
</div>

<!-- Dashboard -->
<div class="dashboard" id="dashboard">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h3><i class="fas fa-door-open"></i> <span>Izin Keluar</span></h3>
    </div>
    <ul class="sidebar-menu">
      <li>
        <a href="#" class="active" id="menu-dashboard">
          <i class="fas fa-tachometer-alt"></i>
          <span>Dashboard</span>
        </a>
      </li>
      <li>
        <a href="#" id="menu-izin">
          <i class="fas fa-file-alt"></i>
          <span>Pengajuan Izin</span>
        </a>
      </li>
      <li>
        <a href="#" id="menu-history">
          <i class="fas fa-history"></i>
          <span>Riwayat Izin</span>
        </a>
      </li>
      <li>
        <a href="#" id="menu-current">
          <i class="fas fa-user-clock"></i>
          <span>Staff Izin</span>
        </a>
      </li>
      <li id="admin-menu" style="display: none;">
        <a href="#" id="menu-admin">
          <i class="fas fa-users-cog"></i>
          <span>Admin Panel</span>
        </a>
      </li>
    </ul>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Header -->
    <div class="header">
      <div class="page-title">
        <h2 id="page-title">Dashboard</h2>
        <p id="page-subtitle">Ringkasan sistem izin keluar</p>
      </div>
      <div class="user-menu">
        <div class="user-info">
          <div class="user-avatar" id="user-avatar">AD</div>
          <span class="user-name" id="user-name">Administrator</span>
        </div>
        <button class="logout-btn" onclick="logout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </div>

    <!-- Dashboard Content -->
    <div id="dashboard-content">
      <div class="stats-container">
        <div class="stat-card">
          <i class="fas fa-clock" style="color: var(--warning);"></i>
          <div class="stat-value" id="pending-count">0</div>
          <div class="stat-label">Menunggu Persetujuan</div>
        </div>
        <div class="stat-card">
          <i class="fas fa-check-circle" style="color: var(--success);"></i>
          <div class="stat-value" id="approved-count">0</div>
          <div class="stat-label">Disetujui Hari Ini</div>
        </div>
        <div class="stat-card">
          <i class="fas fa-user-clock" style="color: var(--primary);"></i>
          <div class="stat-value" id="current-count">0</div>
          <div class="stat-label">Sedang Izin</div>
        </div>
        <div class="stat-card">
          <i class="fas fa-times-circle" style="color: var(--danger);"></i>
          <div class="stat-value" id="rejected-count">0</div>
          <div class="stat-label">Ditolak Bulan Ini</div>
        </div>
      </div>

      <div class="row">
        <div class="form-col">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">
                <i class="fas fa-edit"></i> Ajukan Izin Keluar
              </h3>
            </div>
            <form id="izinForm">
              <div class="form-row">
                <div class="form-col">
                  <div class="form-group">
                    <label for="tanggal">Tanggal Izin</label>
                    <input type="date" class="form-control" id="tanggal" required>
                    <div class="error-message" id="tanggal-error"></div>
                  </div>
                </div>
                <div class="form-col">
                  <div class="form-group">
                    <label for="alasan">Alasan</label>
                    <select class="form-control" id="alasan" required>
                      <option value="">Pilih alasan...</option>
                      <option value="Urusan Keluarga">Urusan Keluarga</option>
                      <option value="Urusan Kesehatan">Urusan Kesehatan</option>
                      <option value="Urusan Pribadi">Urusan Pribadi</option>
                      <option value="Lainnya">Lainnya</option>
                    </select>
                    <div class="error-message" id="alasan-error"></div>
                  </div>
                </div>
              </div>
              <div class="form-row">
                <div class="form-col">
                  <div class="form-group">
                    <label for="jam-keluar">Jam Keluar</label>
                    <input type="time" class="form-control" id="jam-keluar" required>
                    <div class="error-message" id="jam-keluar-error"></div>
                  </div>
                </div>
                <div class="form-col">
                  <div class="form-group">
                    <label for="jam-kembali">Jam Kembali</label>
                    <input type="time" class="form-control" id="jam-kembali" required>
                    <div class="error-message" id="jam-kembali-error"></div>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="keterangan">Keterangan (Detail)</label>
                <textarea class="form-control" id="keterangan" rows="3" required></textarea>
                <div class="error-message" id="keterangan-error"></div>
              </div>
              <button type="submit" class="btn">
                <i class="fas fa-paper-plane"></i> Ajukan Izin
              </button>
            </form>
          </div>
        </div>

        <div class="form-col">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">
                <i class="fas fa-history"></i> Riwayat Hari Ini
              </h3>
            </div>
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Tanggal</th>
                    <th>Jam</th>
                    <th>Status</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="today-izin">
                  <tr>
                    <td colspan="4" style="text-align: center;">Belum ada data izin hari ini</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3 class="card-title">
            <i class="fas fa-list"></i> Daftar Izin Anda
          </h3>
        </div>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Tanggal</th>
                <th>Jam Keluar</th>
                <th>Jam Kembali</th>
                <th>Alasan</th>
                <th>Status</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody id="izinTableBody">
              <tr>
                <td colspan="6" style="text-align: center;">Belum ada data izin</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- History Content -->
    <div id="history-content" style="display: none;">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">
            <i class="fas fa-history"></i> Riwayat Izin
          </h3>
          <div class="filter-group">
            <label for="filter-month">Bulan:</label>
            <select id="filter-month">
              <option value="all">Semua Bulan</option>
              <option value="1">Januari</option>
              <option value="2">Februari</option>
              <option value="3">Maret</option>
              <option value="4">April</option>
              <option value="5">Mei</option>
              <option value="6">Juni</option>
              <option value="7">Juli</option>
              <option value="8">Agustus</option>
              <option value="9">September</option>
              <option value="10">Oktober</option>
              <option value="11">November</option>
              <option value="12">Desember</option>
            </select>
            <label for="filter-year">Tahun:</label>
            <input type="number" id="filter-year" min="2020" max="2030" value="2023">
            <button onclick="filterHistory()">Filter</button>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Tanggal</th>
                <th>Jam Keluar</th>
                <th>Jam Kembali</th>
                <th>Alasan</th>
                <th>Status</th>
                <th>Keterlambatan</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody id="historyTableBody">
              <tr>
                <td colspan="7" style="text-align: center;">Memuat data...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Current Permission Content -->
    <div id="current-content" style="display: none;">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">
            <i class="fas fa-user-clock"></i> Staff Sedang Izin
          </h3>
        </div>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Nama</th>
                <th>Tanggal</th>
                <th>Jam Keluar</th>
                <th>Jam Kembali</th>
                <th>Alasan</th>
                <th>Status</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody id="currentTableBody">
              <tr>
                <td colspan="7" style="text-align: center;">Memuat data...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Admin Content -->
    <div id="admin-content" style="display: none;">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">
            <i class="fas fa-tasks"></i> Semua Pengajuan Izin
          </h3>
          <div class="filter-group">
            <label for="admin-filter-status">Status:</label>
            <select id="admin-filter-status">
              <option value="all">Semua Status</option>
              <option value="pending">Menunggu</option>
              <option value="approved">Disetujui</option>
              <option value="rejected">Ditolak</option>
            </select>
            <label for="admin-filter-date">Tanggal:</label>
            <input type="date" id="admin-filter-date">
            <button onclick="filterAdminTable()">Filter</button>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Nama</th>
                <th>Role</th>
                <th>Tanggal</th>
                <th>Jam</th>
                <th>Alasan</th>
                <th>Status</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody id="adminIzinTableBody">
              <tr>
                <td colspan="7" style="text-align: center;">Memuat data...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Detail Izin -->
<div class="modal" id="detailModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">
        <i class="fas fa-info-circle"></i> Detail Izin Keluar
      </h3>
      <button class="close-btn" onclick="closeModal()">&times;</button>
    </div>
    <div class="modal-body" id="modalBody">
      <!-- Konten akan diisi oleh JavaScript -->
    </div>
    <div class="modal-footer">
      <button class="btn" onclick="closeModal()">
        <i class="fas fa-times"></i> Tutup
      </button>
    </div>
  </div>
</div>

<script>
// Database sederhana
const users = [
  // Admin accounts
  {
    id: 999,
    username: "admin1",
    password: "admin123",
    name: "Admin Utama",
    role: "admin",
    maxPersonal: 0,
    maxRole: 0
  },
  {
    id: 998,
    username: "admin2",
    password: "admin456",
    name: "Admin Backup",
    role: "admin",
    maxPersonal: 0,
    maxRole: 0
  },

  // CS Staff
  { id: 1, username: "widjaya", password: "cs123", name: "WIDJAYA", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 2, username: "david", password: "cs123", name: "DAVID", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 3, username: "fallen", password: "cs123", name: "FALLEN HARDINANSAH TAJU", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 4, username: "shofian", password: "cs123", name: "SHOFIAN KURNIADY", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 5, username: "charlie", password: "cs123", name: "CHARLIE", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 6, username: "harianto", password: "cs123", name: "HARIANTO", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 7, username: "rinal", password: "cs123", name: "RINAL ABDILLAH NASUTION", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 8, username: "eri", password: "cs123", name: "ERI HARIANTO", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 9, username: "mahendran", password: "cs123", name: "MAHENDRAN", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 10, username: "andhika", password: "cs123", name: "ANDHIKA DWI PUTRA", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 11, username: "tommy", password: "cs123", name: "TOMMY HASIM", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 12, username: "egi", password: "cs123", name: "EGI SETIAWAN", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 13, username: "ranjit", password: "cs123", name: "RANJIT", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 14, username: "willy", password: "cs123", name: "WILLY PERAYUDA", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 15, username: "angga", password: "cs123", name: "ANGGA AZMAL HARAHAP", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 16, username: "lalu", password: "cs123", name: "LALU MUHAMMAD ADNAN ZAKARIA", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 17, username: "andi", password: "cs123", name: "ANDI", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 18, username: "ari", password: "cs123", name: "ARI ROMANDUS FERNAND", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 19, username: "alfino", password: "cs123", name: "ALFINO MUKTI", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 20, username: "akas", password: "cs123", name: "AKAS FARMA", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 21, username: "samsul", password: "cs123", name: "SAMSUL MAARIF", role: "CS", maxPersonal: 4, maxRole: 3 },
  { id: 22, username: "paris", password: "cs123", name: "PARIS AMRULLOH", role: "CS", maxPersonal: 4, maxRole: 3 },

  // Kapten Staff
  { id: 23, username: "suhan", password: "kapten123", name: "SUHAN RAZ", role: "Kapten", maxPersonal: 4, maxRole: 2 },
  { id: 24, username: "noval", password: "kapten123", name: "NOVAL MUTTAWALI HAKIM", role: "Kapten", maxPersonal: 4, maxRole: 2 },
  { id: 25, username: "wiliam", password: "kapten123", name: "WILIAM", role: "Kapten", maxPersonal: 4, maxRole: 2 },
  { id: 26, username: "fiqal", password: "kapten123", name: "FIQAL KANA", role: "Kapten", maxPersonal: 4, maxRole: 2 },
  { id: 27, username: "marjoki", password: "kapten123", name: "MARJOKI SANG", role: "Kapten", maxPersonal: 4, maxRole: 2 },
  { id: 28, username: "daniel", password: "kapten123", name: "DANIEL", role: "Kapten", maxPersonal: 4, maxRole: 2 },

  // Kasir Staff
  { id: 29, username: "putra1", password: "kasir123", name: "PUTRA ANUGRAH RIZKI", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 30, username: "putra2", password: "kasir123", name: "PUTRA RAMADHANI", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 31, username: "laili", password: "kasir123", name: "LAILI MARITSA", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 32, username: "annen", password: "kasir123", name: "ANNEN", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 33, username: "jonroman", password: "kasir123", name: "JONROMAN PURBA", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 34, username: "raaz", password: "kasir123", name: "RAAZ JESEN STEPANUS", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 35, username: "fajar", password: "kasir123", name: "M FAJAR SIDDIK", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 36, username: "rahmadi", password: "kasir123", name: "RAHMADI SORMIN", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 37, username: "amrul", password: "kasir123", name: "AMRUL", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 38, username: "ram", password: "kasir123", name: "RAM KIRAN", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 39, username: "boby", password: "kasir123", name: "BOBY KASANDRA BANCIN", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 40, username: "kiki", password: "kasir123", name: "KIKI YUNITA", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 41, username: "mahat", password: "kasir123", name: "MAHAT SANJAYA HARAHAP", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 42, username: "charloipo", password: "kasir123", name: "CHARLOIPO MANULLANG", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 43, username: "fahmi", password: "kasir123", name: "FAHMI AZIS HARAHAP", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 44, username: "fahri", password: "kasir123", name: "FAHRI FIRMANSYAH", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 45, username: "prima", password: "kasir123", name: "PRIMA NUGRAHA", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 46, username: "roy", password: "kasir123", name: "ROY DILEN", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 47, username: "gali", password: "kasir123", name: "GALI PRATAMA", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 48, username: "ridzky", password: "kasir123", name: "RIDZKY RAMADHAN", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 49, username: "agung", password: "kasir123", name: "AGUNG DEDI IRAWAN", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 50, username: "maicel", password: "kasir123", name: "MAICEL TAMPUBOLON", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 51, username: "ade1", password: "kasir123", name: "ADE CHAIRUNNISA", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 52, username: "rezi", password: "kasir123", name: "M REZI SYAPUTRA", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 53, username: "khoiruddin", password: "kasir123", name: "KHOIRUDDIN", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 54, username: "bambang", password: "kasir123", name: "BAMBANG AGUNG SUTRISNO", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 55, username: "putra3", password: "kasir123", name: "PUTRA INSANY", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 56, username: "andrianus", password: "kasir123", name: "ANDRIANUS", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 57, username: "fera", password: "kasir123", name: "FERA SALMA", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 58, username: "rivlan", password: "kasir123", name: "RIVLAN RIZKY", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 59, username: "maulana", password: "kasir123", name: "MAULANA ALI SAID", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 60, username: "ahmad", password: "kasir123", name: "AHMAD ANDIKA", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 61, username: "anggara", password: "kasir123", name: "ANGGARA K S", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 62, username: "dimas", password: "kasir123", name: "DIMAS ADHITYA", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 63, username: "gabriel", password: "kasir123", name: "GABRIEL RONI ARGANTA HUTABALIAN", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 64, username: "dandi", password: "kasir123", name: "DANDI PRAYOGA MANURUNG", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 65, username: "ega", password: "kasir123", name: "EGA PRAYUDA", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 66, username: "arjun", password: "kasir123", name: "ARJUN PRAISYA", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 67, username: "aditya", password: "kasir123", name: "ADITYA PANCA", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 68, username: "audis", password: "kasir123", name: "AUDIS OYONG DUANSYAH", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 69, username: "ade2", password: "kasir123", name: "ADE OJI SHAPUTRA", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 70, username: "alfiansyah", password: "kasir123", name: "ALFIANSYAH", role: "Kasir", maxPersonal: 4, maxRole: 3 },
  { id: 71, username: "andy", password: "kasir123", name: "ANDY PUTRA", role: "Kasir", maxPersonal: 4, maxRole: 3 }
];

let allIzinData = [];
let currentUserIzin = [];
let currentUser = null;

// Fungsi untuk menampilkan pesan error
function showError(elementId, message) {
  const errorElement = document.getElementById(elementId);
  errorElement.textContent = message;
  errorElement.style.display = 'block';
}

// Fungsi untuk menghilangkan pesan error
function hideError(elementId) {
  document.getElementById(elementId).style.display = 'none';
}

// Fungsi untuk validasi login
function validateLogin(username, password) {
  hideError('username-error');
  hideError('password-error');

  let isValid = true;

  if (!username) {
    showError('username-error', 'Username harus diisi');
    isValid = false;
  }

  if (!password) {
    showError('password-error', 'Password harus diisi');
    isValid = false;
  }

  return isValid;
}

// Fungsi untuk login
document.getElementById('loginForm').addEventListener('submit', function(e) {
  e.preventDefault();

  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;

  if (!validateLogin(username, password)) {
    return;
  }

  // Cari user
  const user = users.find(u => u.username === username && u.password === password);

  if (user) {
    currentUser = user;
    localStorage.setItem('currentUser', JSON.stringify(user));

    // Update UI
    document.getElementById('login-page').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';
    document.getElementById('user-name').textContent = user.name;
    document.getElementById('user-avatar').textContent = user.name.charAt(0).toUpperCase();

    // Tampilkan menu admin jika role admin
    if (user.role === 'admin') {
      document.getElementById('admin-menu').style.display = 'block';
    }

    loadIzinData();

    // Reset form login
    document.getElementById('loginForm').reset();
  } else {
    showError('password-error', 'Username atau password salah');
  }
});

// Fungsi untuk load data izin
function loadIzinData() {
  // Contoh data izin
  const today = new Date().toISOString().split('T')[0];
  const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
  
  allIzinData = [
    {
      id: 1,
      userId: 1,
      userName: "WIDJAYA",
      userRole: "CS",
      tanggal: today,
      jamKeluar: '10:00',
      jamKembali: '12:00',
      alasan: 'Urusan Keluarga',
      keterangan: 'Mengantar anak ke dokter',
      status: 'approved',
      tanggalPengajuan: new Date().toISOString(),
      lateReturn: false
    },
    {
      id: 2,
      userId: 1,
      userName: "WIDJAYA",
      userRole: "CS",
      tanggal: today,
      jamKeluar: '14:00',
      jamKembali: '16:30',
      alasan: 'Urusan Pribadi',
      keterangan: 'Perpanjang SIM',
      status: 'pending',
      tanggalPengajuan: new Date().toISOString(),
      lateReturn: false
    },
    {
      id: 3,
      userId: 29,
      userName: "PUTRA ANUGRAH RIZKI",
      userRole: "Kasir",
      tanggal: today,
      jamKeluar: '09:00',
      jamKembali: '11:00',
      alasan: 'Urusan Kesehatan',
      keterangan: 'Kontrol ke dokter',
      status: 'pending',
      tanggalPengajuan: new Date().toISOString(),
      lateReturn: false
    },
    {
      id: 4,
      userId: 23,
      userName: "SUHAN RAZ",
      userRole: "Kapten",
      tanggal: today,
      jamKeluar: '13:00',
      jamKembali: '15:00',
      alasan: 'Urusan Keluarga',
      keterangan: 'Menjenguk orang tua',
      status: 'approved',
      tanggalPengajuan: new Date().toISOString(),
      lateReturn: true
    },
    {
      id: 5,
      userId: 30,
      userName: "PUTRA RAMADHANI",
      userRole: "Kasir",
      tanggal: yesterday,
      jamKeluar: '10:00',
      jamKembali: '12:00',
      alasan: 'Urusan Pribadi',
      keterangan: 'Perpanjang STNK',
      status: 'rejected',
      tanggalPengajuan: new Date(Date.now() - 86400000).toISOString(),
      lateReturn: false
    },
    {
      id: 6,
      userId: 1,
      userName: "WIDJAYA",
      userRole: "CS",
      tanggal: yesterday,
      jamKeluar: '09:00',
      jamKembali: '11:00',
      alasan: 'Urusan Kesehatan',
      keterangan: 'Periksa ke dokter',
      status: 'approved',
      tanggalPengajuan: new Date(Date.now() - 86400000).toISOString(),
      lateReturn: false
    }
  ];

  // Filter izin untuk user yang login
  currentUserIzin = allIzinData.filter(izin => izin.userId === currentUser.id);

  updateStats();
  renderUserIzinTable();
  renderTodayIzin();
  renderHistoryTable();
  renderCurrentIzin();

  // Jika admin, render juga tabel admin
  if (currentUser.role === 'admin') {
    renderAdminIzinTable();
  }
}

// Fungsi untuk update statistik
function updateStats() {
  const today = new Date().toISOString().split('T')[0];
  const currentMonth = new Date().getMonth() + 1;
  const currentYear = new Date().getFullYear();
  
  // Hitung izin pending
  const pendingCount = allIzinData.filter(izin => izin.status === 'pending').length;
  document.getElementById('pending-count').textContent = pendingCount;
  
  // Hitung izin approved hari ini
  const approvedToday = allIzinData.filter(izin => 
    izin.status === 'approved' && izin.tanggal === today
  ).length;
  document.getElementById('approved-count').textContent = approvedToday;
  
  // Hitung staff yang sedang izin (approved dan jam sekarang antara jam keluar dan kembali)
  const now = new Date();
  const currentTime = now.getHours() * 100 + now.getMinutes();
  
  const currentIzin = allIzinData.filter(izin => {
    if (izin.status !== 'approved' || izin.tanggal !== today) return false;
    
    const [keluarHours, keluarMinutes] = izin.jamKeluar.split(':').map(Number);
    const [kembaliHours, kembaliMinutes] = izin.jamKembali.split(':').map(Number);
    
    const keluarTime = keluarHours * 100 + keluarMinutes;
    const kembaliTime = kembaliHours * 100 + kembaliMinutes;
    
    return currentTime >= keluarTime && currentTime <= kembaliTime;
  }).length;
  
  document.getElementById('current-count').textContent = currentIzin;
  
  // Hitung izin rejected bulan ini
  const rejectedThisMonth = allIzinData.filter(izin => {
    if (izin.status !== 'rejected') return false;
    
    const izinDate = new Date(izin.tanggal);
    return izinDate.getMonth() + 1 === currentMonth && izinDate.getFullYear() === currentYear;
  }).length;
  
  document.getElementById('rejected-count').textContent = rejectedThisMonth;
}

// Fungsi untuk render tabel izin user
function renderUserIzinTable() {
  const tableBody = document.getElementById('izinTableBody');
  tableBody.innerHTML = '';

  if (currentUserIzin.length === 0) {
    tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Belum ada data izin</td></tr>';
    return;
  }

  // Urutkan berdasarkan tanggal pengajuan (terbaru pertama)
  currentUserIzin.sort((a, b) => new Date(b.tanggalPengajuan) - new Date(a.tanggalPengajuan));

  currentUserIzin.forEach(izin => {
    const row = document.createElement('tr');

    // Tentukan kelas status
    const statusInfo = getStatusInfo(izin.status);

    row.innerHTML = `
      <td>${formatTanggal(izin.tanggal)}</td>
      <td>${izin.jamKeluar}</td>
      <td>${izin.jamKembali}</td>
      <td>${izin.alasan}</td>
      <td><span class="status-badge ${statusInfo.class}">${statusInfo.text}</span></td>
      <td>
        <button onclick="showDetail(${izin.id})" class="action-btn view-btn" title="Lihat Detail">
          <i class="fas fa-eye"></i>
        </button>
      </td>
    `;

    tableBody.appendChild(row);
  });
}

// Fungsi untuk render riwayat hari ini
function renderTodayIzin() {
  const tableBody = document.getElementById('today-izin');
  tableBody.innerHTML = '';

  const today = new Date().toISOString().split('T')[0];
  const todayData = currentUserIzin.filter(izin => izin.tanggal === today);

  if (todayData.length === 0) {
    tableBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Belum ada data izin hari ini</td></tr>';
    return;
  }

  todayData.forEach(izin => {
    const row = document.createElement('tr');

    // Tentukan kelas status
    const statusInfo = getStatusInfo(izin.status);

    row.innerHTML = `
      <td>${formatTanggal(izin.tanggal)}</td>
      <td>${izin.jamKeluar} - ${izin.jamKembali}</td>
      <td><span class="status-badge ${statusInfo.class}">${statusInfo.text}</span></td>
      <td>
        <button onclick="showDetail(${izin.id})" class="action-btn view-btn" title="Lihat Detail">
          <i class="fas fa-eye"></i>
        </button>
      </td>
    `;

    tableBody.appendChild(row);
  });
}

// Fungsi untuk render riwayat izin
function renderHistoryTable(filterMonth = 'all', filterYear = new Date().getFullYear()) {
  const tableBody = document.getElementById('historyTableBody');
  tableBody.innerHTML = '';

  if (currentUserIzin.length === 0) {
    tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Belum ada data izin</td></tr>';
    return;
  }

  // Filter berdasarkan bulan dan tahun jika diperlukan
  let filteredData = currentUserIzin;
  
  if (filterMonth !== 'all') {
    filteredData = currentUserIzin.filter(izin => {
      const izinDate = new Date(izin.tanggal);
      return izinDate.getMonth() + 1 == filterMonth && izinDate.getFullYear() == filterYear;
    });
  } else {
    filteredData = currentUserIzin.filter(izin => {
      const izinDate = new Date(izin.tanggal);
      return izinDate.getFullYear() == filterYear;
    });
  }

  if (filteredData.length === 0) {
    tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Tidak ada data izin untuk filter yang dipilih</td></tr>';
    return;
  }

  // Urutkan berdasarkan tanggal (terbaru pertama)
  filteredData.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));

  filteredData.forEach(izin => {
    const row = document.createElement('tr');

    // Tentukan kelas status
    const statusInfo = getStatusInfo(izin.status);

    row.innerHTML = `
      <td>${formatTanggal(izin.tanggal)}</td>
      <td>${izin.jamKeluar}</td>
      <td>${izin.jamKembali}</td>
      <td>${izin.alasan}</td>
      <td><span class="status-badge ${statusInfo.class}">${statusInfo.text}</span></td>
      <td>${izin.lateReturn ? '<span class="badge badge-warning">Terlambat</span>' : '<span class="badge badge-primary">Tepat Waktu</span>'}</td>
      <td>
        <button onclick="showDetail(${izin.id})" class="action-btn view-btn" title="Lihat Detail">
          <i class="fas fa-eye"></i>
        </button>
      </td>
    `;

    tableBody.appendChild(row);
  });
}

// Fungsi untuk render staff yang sedang izin
function renderCurrentIzin() {
  const tableBody = document.getElementById('currentTableBody');
  tableBody.innerHTML = '';

  const today = new Date().toISOString().split('T')[0];
  const now = new Date();
  const currentTime = now.getHours() * 100 + now.getMinutes();

  const currentData = allIzinData.filter(izin => {
    if (izin.status !== 'approved' || izin.tanggal !== today) return false;
    
    const [keluarHours, keluarMinutes] = izin.jamKeluar.split(':').map(Number);
    const [kembaliHours, kembaliMinutes] = izin.jamKembali.split(':').map(Number);
    
    const keluarTime = keluarHours * 100 + keluarMinutes;
    const kembaliTime = kembaliHours * 100 + kembaliMinutes;
    
    return currentTime >= keluarTime && currentTime <= kembaliTime;
  });

  if (currentData.length === 0) {
    tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Tidak ada staff yang sedang izin saat ini</td></tr>';
    return;
  }

  currentData.forEach(izin => {
    const row = document.createElement('tr');

    row.innerHTML = `
      <td>${izin.userName}</td>
      <td>${formatTanggal(izin.tanggal)}</td>
      <td>${izin.jamKeluar}</td>
      <td>${izin.jamKembali}</td>
      <td>${izin.alasan}</td>
      <td><span class="status-badge status-current">Sedang Izin</span></td>
      <td>
        <button onclick="showDetail(${izin.id}, true)" class="action-btn view-btn" title="Lihat Detail">
          <i class="fas fa-eye"></i>
        </button>
      </td>
    `;

    tableBody.appendChild(row);
  });
}

// Fungsi untuk render tabel izin admin
function renderAdminIzinTable(filterStatus = 'all', filterDate = '') {
  const tableBody = document.getElementById('adminIzinTableBody');
  tableBody.innerHTML = '';

  // Filter data
  let filteredData = allIzinData;
  
  if (filterStatus !== 'all') {
    filteredData = allIzinData.filter(izin => izin.status === filterStatus);
  }
  
  if (filterDate) {
    filteredData = filteredData.filter(izin => izin.tanggal === filterDate);
  }

  if (filteredData.length === 0) {
    tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Tidak ada data izin untuk filter yang dipilih</td></tr>';
    return;
  }

  // Urutkan berdasarkan tanggal pengajuan (terbaru pertama)
  filteredData.sort((a, b) => new Date(b.tanggalPengajuan) - new Date(a.tanggalPengajuan));

  filteredData.forEach(izin => {
    const row = document.createElement('tr');

    // Tentukan kelas status
    const statusInfo = getStatusInfo(izin.status);

    row.innerHTML = `
      <td>${izin.userName}</td>
      <td>${izin.userRole}</td>
      <td>${formatTanggal(izin.tanggal)}</td>
      <td>${izin.jamKeluar} - ${izin.jamKembali}</td>
      <td>${izin.alasan}</td>
      <td><span class="status-badge ${statusInfo.class}">${statusInfo.text}</span></td>
      <td>
        ${izin.status === 'pending' ? `
        <button onclick="approveIzin(${izin.id})" class="action-btn edit-btn" title="Setujui">
          <i class="fas fa-check"></i>
        </button>
        <button onclick="rejectIzin(${izin.id})" class="action-btn delete-btn" title="Tolak">
          <i class="fas fa-times"></i>
        </button>
        ` : ''}
        <button onclick="showDetail(${izin.id}, true)" class="action-btn view-btn" title="Lihat Detail">
          <i class="fas fa-eye"></i>
        </button>
      </td>
    `;

    tableBody.appendChild(row);
  });
}

// Fungsi untuk filter history
function filterHistory() {
  const month = document.getElementById('filter-month').value;
  const year = document.getElementById('filter-year').value;
  renderHistoryTable(month, year);
}

// Fungsi untuk filter tabel admin
function filterAdminTable() {
  const status = document.getElementById('admin-filter-status').value;
  const date = document.getElementById('admin-filter-date').value;
  renderAdminIzinTable(status, date);
}

// Fungsi untuk mendapatkan info status
function getStatusInfo(status) {
  if (status === 'approved') {
    return { class: 'status-approved', text: 'Disetujui' };
  } else if (status === 'rejected') {
    return { class: 'status-rejected', text: 'Ditolak' };
  } else {
    return { class: 'status-pending', text: 'Menunggu' };
  }
}

// Fungsi untuk format tanggal
function formatTanggal(tanggal) {
  const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
  return new Date(tanggal).toLocaleDateString('id-ID', options);
}

// Fungsi untuk validasi form izin
function validateIzinForm() {
  let isValid = true;

  // Sembunyikan semua error terlebih dahulu
  hideError('tanggal-error');
  hideError('jam-keluar-error');
  hideError('jam-kembali-error');
  hideError('alasan-error');
  hideError('keterangan-error');

  // Validasi tanggal
  const tanggal = document.getElementById('tanggal').value;
  if (!tanggal) {
    showError('tanggal-error', 'Tanggal harus diisi');
    isValid = false;
  } else if (new Date(tanggal) < new Date(new Date().setHours(0, 0, 0, 0))) {
    showError('tanggal-error', 'Tanggal tidak boleh hari kemarin');
    isValid = false;
  }

  // Validasi jam
  const jamKeluar = document.getElementById('jam-keluar').value;
  const jamKembali = document.getElementById('jam-kembali').value;

  if (!jamKeluar) {
    showError('jam-keluar-error', 'Jam keluar harus diisi');
    isValid = false;
  }

  if (!jamKembali) {
    showError('jam-kembali-error', 'Jam kembali harus diisi');
    isValid = false;
  }

  if (jamKeluar && jamKembali && jamKembali <= jamKeluar) {
    showError('jam-kembali-error', 'Jam kembali harus setelah jam keluar');
    isValid = false;
  }

  // Validasi alasan
  const alasan = document.getElementById('alasan').value;
  if (!alasan) {
    showError('alasan-error', 'Alasan harus dipilih');
    isValid = false;
  }

  // Validasi keterangan
  const keterangan = document.getElementById('keterangan').value;
  if (!keterangan) {
    showError('keterangan-error', 'Keterangan harus diisi');
    isValid = false;
  }

  // Validasi limit izin per orang
  if (isValid) {
    const today = new Date().toISOString().split('T')[0];
    const userIzinToday = currentUserIzin.filter(izin => izin.tanggal === today).length;
    
    if (userIzinToday >= currentUser.maxPersonal) {
      showError('tanggal-error', `Anda sudah mencapai batas maksimal ${currentUser.maxPersonal} izin per hari`);
      isValid = false;
    }
    
    // Validasi limit izin per role
    const roleIzinToday = allIzinData.filter(izin => 
      izin.userRole === currentUser.role && izin.tanggal === today
    ).length;
    
    if (roleIzinToday >= currentUser.maxRole) {
      showError('tanggal-error', `Role ${currentUser.role} sudah mencapai batas maksimal ${currentUser.maxRole} izin per hari`);
      isValid = false;
    }
  }

  return isValid;
}

// Fungsi untuk menampilkan detail izin
function showDetail(izinId, isAdmin = false) {
  const izin = isAdmin
    ? allIzinData.find(item => item.id === izinId)
    : currentUserIzin.find(item => item.id === izinId);

  if (!izin) return;

  const modalBody = document.getElementById('modalBody');
  const statusInfo = getStatusInfo(izin.status);
  const user = users.find(u => u.id === izin.userId);

  modalBody.innerHTML = `
    <div class="form-group">
      <label>Nama:</label>
      <p>${izin.userName || 'Tidak tersedia'}</p>
    </div>

    ${user ? `
    <div class="form-group">
      <label>Role:</label>
      <p>${user.role}</p>
    </div>
    ` : ''}

    <div class="form-group">
      <label>Tanggal Izin:</label>
      <p>${formatTanggal(izin.tanggal)}</p>
    </div>

    <div class="form-group">
      <label>Jam Keluar:</label>
      <p>${izin.jamKeluar}</p>
    </div>

    <div class="form-group">
      <label>Jam Kembali:</label>
      <p>${izin.jamKembali}</p>
    </div>

    <div class="form-group">
      <label>Alasan:</label>
      <p>${izin.alasan}</p>
    </div>

    <div class="form-group">
      <label>Keterangan:</label>
      <p>${izin.keterangan}</p>
    </div>

    <div class="form-group">
      <label>Status:</label>
      <p><span class="status-badge ${statusInfo.class}">${statusInfo.text}</span></p>
    </div>

    <div class="form-group">
      <label>Keterlambatan:</label>
      <p>${izin.lateReturn ? '<span class="badge badge-warning">Terlambat Kembali</span>' : '<span class="badge badge-primary">Tepat Waktu</span>'}</p>
    </div>

    <div class="form-group">
      <label>Tanggal Pengajuan:</label>
      <p>${new Date(izin.tanggalPengajuan).toLocaleString('id-ID')}</p>
    </div>
  `;

  document.getElementById('detailModal').style.display = 'flex';
}

// Fungsi untuk menyetujui izin (admin)
function approveIzin(izinId) {
  const izin = allIzinData.find(item => item.id === izinId);
  if (izin) {
    izin.status = 'approved';

    // Update di currentUserIzin jika ada
    const userIzin = currentUserIzin.find(item => item.id === izinId);
    if (userIzin) {
      userIzin.status = 'approved';
    }

    updateStats();
    renderAdminIzinTable();
    renderUserIzinTable();
    renderTodayIzin();
    renderCurrentIzin();
    alert('Izin telah disetujui!');
  }
}

// Fungsi untuk menolak izin (admin)
function rejectIzin(izinId) {
  const izin = allIzinData.find(item => item.id === izinId);
  if (izin) {
    izin.status = 'rejected';

    // Update di currentUserIzin jika ada
    const userIzin = currentUserIzin.find(item => item.id === izinId);
    if (userIzin) {
      userIzin.status = 'rejected';
    }

    updateStats();
    renderAdminIzinTable();
    renderUserIzinTable();
    renderTodayIzin();
    alert('Izin telah ditolak!');
  }
}

// Fungsi untuk menutup modal
function closeModal() {
  document.getElementById('detailModal').style.display = 'none';
}

// Fungsi untuk mengajukan izin baru
document.getElementById('izinForm').addEventListener('submit', function(e) {
  e.preventDefault();

  if (!validateIzinForm()) {
    return;
  }

  const tanggal = document.getElementById('tanggal').value;
  const jamKeluar = document.getElementById('jam-keluar').value;
  const jamKembali = document.getElementById('jam-kembali').value;
  const alasan = document.getElementById('alasan').value;
  const keterangan = document.getElementById('keterangan').value;

  // Buat objek izin baru
  const newIzin = {
    id: allIzinData.length > 0 ? Math.max(...allIzinData.map(i => i.id)) + 1 : 1,
    userId: currentUser.id,
    userName: currentUser.name,
    userRole: currentUser.role,
    tanggal: tanggal,
    jamKeluar: jamKeluar,
    jamKembali: jamKembali,
    alasan: alasan,
    keterangan: keterangan,
    status: 'pending',
    tanggalPengajuan: new Date().toISOString(),
    lateReturn: false
  };

  // Tambahkan ke array allIzinData
  allIzinData.unshift(newIzin);
  currentUserIzin.unshift(newIzin);

  // Update stats dan render ulang tabel
  updateStats();
  renderUserIzinTable();
  renderTodayIzin();

  // Jika admin sedang login, update juga tabel admin
  if (currentUser.role === 'admin') {
    renderAdminIzinTable();
  }

  // Reset form
  document.getElementById('izinForm').reset();

  // Tampilkan pesan sukses
  alert('Izin keluar berhasil diajukan!');
});

// Fungsi untuk logout
function logout() {
  currentUser = null;
  localStorage.removeItem('currentUser');

  document.getElementById('dashboard').style.display = 'none';
  document.getElementById('login-page').style.display = 'flex';

  // Reset form login
  document.getElementById('loginForm').reset();
}

// Menu navigation
document.getElementById('menu-dashboard').addEventListener('click', function(e) {
  e.preventDefault();
  document.getElementById('dashboard-content').style.display = 'block';
  document.getElementById('history-content').style.display = 'none';
  document.getElementById('current-content').style.display = 'none';
  document.getElementById('admin-content').style.display = 'none';
  document.getElementById('page-title').textContent = 'Dashboard';
  document.getElementById('page-subtitle').textContent = 'Ringkasan sistem izin keluar';
});

document.getElementById('menu-izin').addEventListener('click', function(e) {
  e.preventDefault();
  document.getElementById('dashboard-content').style.display = 'block';
  document.getElementById('history-content').style.display = 'none';
  document.getElementById('current-content').style.display = 'none';
  document.getElementById('admin-content').style.display = 'none';
  document.getElementById('page-title').textContent = 'Pengajuan Izin';
  document.getElementById('page-subtitle').textContent = 'Form pengajuan izin keluar';
});

document.getElementById('menu-history').addEventListener('click', function(e) {
  e.preventDefault();
  document.getElementById('dashboard-content').style.display = 'none';
  document.getElementById('history-content').style.display = 'block';
  document.getElementById('current-content').style.display = 'none';
  document.getElementById('admin-content').style.display = 'none';
  document.getElementById('page-title').textContent = 'Riwayat Izin';
  document.getElementById('page-subtitle').textContent = 'Daftar riwayat pengajuan izin';
});

document.getElementById('menu-current').addEventListener('click', function(e) {
  e.preventDefault();
  document.getElementById('dashboard-content').style.display = 'none';
  document.getElementById('history-content').style.display = 'none';
  document.getElementById('current-content').style.display = 'block';
  document.getElementById('admin-content').style.display = 'none';
  document.getElementById('page-title').textContent = 'Staff Izin';
  document.getElementById('page-subtitle').textContent = 'Daftar staff yang sedang izin';
  renderCurrentIzin();
});

document.getElementById('menu-admin').addEventListener('click', function(e) {
  e.preventDefault();
  document.getElementById('dashboard-content').style.display = 'none';
  document.getElementById('history-content').style.display = 'none';
  document.getElementById('current-content').style.display = 'none';
  document.getElementById('admin-content').style.display = 'block';
  document.getElementById('page-title').textContent = 'Admin Panel';
  document.getElementById('page-subtitle').textContent = 'Kelola semua pengajuan izin';
});

// Cek apakah user sudah login saat page load
window.onload = function() {
  const savedUser = localStorage.getItem('currentUser');

  if (savedUser) {
    currentUser = JSON.parse(savedUser);

    // Update UI
    document.getElementById('login-page').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';
    document.getElementById('user-name').textContent = currentUser.name;
    document.getElementById('user-avatar').textContent = currentUser.name.charAt(0).toUpperCase();

    // Tampilkan menu admin jika role admin
    if (currentUser.role === 'admin') {
      document.getElementById('admin-menu').style.display = 'block';
    }

    loadIzinData();
  }
  
  // Set default filter date to today
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('admin-filter-date').value = today;
  document.getElementById('tanggal').value = today;
};
</script>
</body>
</html>
