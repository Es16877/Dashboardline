<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Izin Keluar - WIB Indonesia</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .clock-container {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .time {
            font-size: 5rem;
            font-weight: bold;
            margin: 0;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .date {
            font-size: 1.5rem;
            margin-top: 10px;
            opacity: 0.8;
        }
        
        .button-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn-exit {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-enter {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .dashboard {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .dashboard h2 {
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 10px;
            margin-top: 0;
        }
        
        .staff-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .staff-card {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        
        .staff-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .staff-position {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-bottom: 10px;
        }
        
        .staff-time {
            font-size: 0.9rem;
            margin-top: auto;
        }
        
        .login-form {
            max-width: 400px;
            margin: 50px auto;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 10px;
        }
        
        .login-form h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: none;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .login-btn:hover {
            background-color: #2980b9;
        }
        
        .hidden {
            display: none;
        }
        
        .admin-panel {
            margin-top: 30px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            cursor: pointer;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        
        .tab.active {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        th {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 15px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-active {
            background-color: #2ecc71;
        }
        
        .status-inactive {
            background-color: #e74c3c;
        }
        
        .add-staff-form {
            margin-top: 20px;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 8px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .position-select {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: none;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .error-message {
            color: #ff6b6b;
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
        }
        
        .counter-container {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            text-align: center;
        }
        
        .counter-box {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            width: 22%;
        }
        
        .counter-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .counter-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .change-password-form {
            margin-top: 30px;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 8px;
        }
        
        .profile-info {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div id="login-page" class="container">
        <div class="login-form">
            <h2>Login Sistem Izin Keluar</h2>
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Masukkan username">
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Masukkan password">
            </div>
            <button class="login-btn" onclick="login()">Login</button>
            <div id="login-error" class="error-message"></div>
        </div>
    </div>

    <div id="main-page" class="container hidden">
        <button class="logout-btn" onclick="logout()">Logout</button>
        <div class="header">
            <h1>Sistem Izin Keluar</h1>
            <p>Durasi izin keluar maksimal 15 menit</p>
        </div>
        
        <div class="clock-container">
            <div class="time" id="time">00:00:00</div>
            <div class="date" id="date">Senin, 1 Januari 2023</div>
        </div>
        
        <div class="button-container">
            <button id="exit-btn" class="btn btn-exit" onclick="requestExit()">IZIN KELUAR</button>
            <button id="enter-btn" class="btn btn-enter" onclick="recordEntry()">IZIN MASUK</button>
        </div>
        
        <div class="dashboard">
            <div class="counter-container">
                <div class="counter-box">
                    <div class="counter-label">Kasir Keluar</div>
                    <div class="counter-value" id="counter-kasir">0</div>
                    <div class="counter-label">Maks: 3 orang</div>
                </div>
                <div class="counter-box">
                    <div class="counter-label">CS Keluar</div>
                    <div class="counter-value" id="counter-cs">0</div>
                    <div class="counter-label">Maks: 3 orang</div>
                </div>
                <div class="counter-box">
                    <div class="counter-label">Khemer Keluar</div>
                    <div class="counter-value" id="counter-khemer">0</div>
                    <div class="counter-label">Maks: 1 orang</div>
                </div>
                <div class="counter-box">
                    <div class="counter-label">Kapten Keluar</div>
                    <div class="counter-value" id="counter-kapten">0</div>
                    <div class="counter-label">Maks: 1 orang</div>
                </div>
            </div>
            
            <h2>Staff Yang Sedang Keluar</h2>
            <div id="staff-out-container" class="staff-list">
                <!-- Staff yang sedang keluar akan ditampilkan di sini -->
            </div>
            
            <div class="profile-info">
                <h3>Profil Saya</h3>
                <p id="profile-name">Nama: -</p>
                <p id="profile-position">Posisi: -</p>
                <button onclick="showChangePasswordForm()">Ganti Password</button>
            </div>
            
            <div id="change-password-form" class="change-password-form hidden">
                <h3>Ganti Password</h3>
                <div class="form-group">
                    <label for="current-password">Password Saat Ini</label>
                    <input type="password" id="current-password" placeholder="Masukkan password saat ini">
                </div>
                <div class="form-group">
                    <label for="new-password">Password Baru</label>
                    <input type="password" id="new-password" placeholder="Masukkan password baru">
                </div>
                <div class="form-group">
                    <label for="confirm-password">Konfirmasi Password Baru</label>
                    <input type="password" id="confirm-password" placeholder="Konfirmasi password baru">
                </div>
                <button class="login-btn" onclick="changePassword()">Simpan Perubahan</button>
                <button onclick="hideChangePasswordForm()">Batal</button>
                <div id="password-change-error" class="error-message"></div>
            </div>
        </div>
        
        <div id="admin-panel" class="admin-panel hidden">
            <h2>Admin Panel</h2>
            <div class="tab-container">
                <button class="tab active" onclick="openTab('staff-management')">Manajemen Staff</button>
                <button class="tab" onclick="openTab('exit-records')">Rekaman Izin Keluar</button>
            </div>
            
            <div id="staff-management" class="tab-content active">
                <h3>Daftar Staff</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Nama</th>
                            <th>Posisi</th>
                            <th>Username</th>
                            <th>Password</th>
                            <th>Status</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="staff-list">
                        <!-- Daftar staff akan ditampilkan di sini -->
                    </tbody>
                </table>
                
                <div class="add-staff-form">
                    <h3>Tambah Staff Baru</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="new-staff-name">Nama Lengkap</label>
                            <input type="text" id="new-staff-name" placeholder="Nama staff">
                        </div>
                        <div class="form-group">
                            <label for="new-staff-position">Posisi</label>
                            <select id="new-staff-position" class="position-select">
                                <option value="kasir">Kasir</option>
                                <option value="cs">Customer Service</option>
                                <option value="kapten">Kapten</option>
                                <option value="khemer">Khemer</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="new-staff-username">Username</label>
                            <input type="text" id="new-staff-username" placeholder="Username">
                        </div>
                        <div class="form-group">
                            <label for="new-staff-password">Password</label>
                            <input type="password" id="new-staff-password" placeholder="Password">
                        </div>
                    </div>
                    <button class="login-btn" onclick="addStaff()">Tambah Staff</button>
                </div>
            </div>
            
            <div id="exit-records" class="tab-content">
                <h3>Riwayat Izin Keluar</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Nama</th>
                            <th>Posisi</th>
                            <th>Waktu Keluar</th>
                            <th>Waktu Masuk</th>
                            <th>Durasi</th>
                        </tr>
                    </thead>
                    <tbody id="exit-records-list">
                        <!-- Riwayat izin keluar akan ditampilkan di sini -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Data awal
        let currentUser = null;
        let staffData = [
            { id: 1, name: "Admin", position: "admin", username: "admin", password: "a1", isActive: true },
            { id: 2, name: "Kasir 1", position: "kasir", username: "kasir1", password: "k1", isActive: true },
            { id: 3, name: "Kasir 2", position: "kasir", username: "kasir2", password: "k2", isActive: true },
            { id: 4, name: "CS 1", position: "cs", username: "cs1", password: "c1", isActive: true },
            { id: 5, name: "Kapten", position: "kapten", username: "kapten1", password: "kap1", isActive: true },
            { id: 6, name: "Khemer", position: "khemer", username: "khemer1", password: "kh1", isActive: true }
        ];
        
        let exitRecords = [];
        let currentlyOut = [];
        
        // Fungsi untuk menyimpan data ke localStorage
        const saveData = () => {
            localStorage.setItem('staffData', JSON.stringify(staffData));
            localStorage.setItem('exitRecords', JSON.stringify(exitRecords));
            localStorage.setItem('currentlyOut', JSON.stringify(currentlyOut));
            if (currentUser) {
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }
        };
        
        // Fungsi untuk memuat data dari localStorage
        const loadData = () => {
            const savedStaff = localStorage.getItem('staffData');
            const savedRecords = localStorage.getItem('exitRecords');
            const savedOut = localStorage.getItem('currentlyOut');
            const savedUser = localStorage.getItem('currentUser');
            
            if(savedStaff) staffData = JSON.parse(savedStaff);
            if(savedRecords) exitRecords = JSON.parse(savedRecords);
            if(savedOut) currentlyOut = JSON.parse(savedOut);
            if(savedUser) currentUser = JSON.parse(savedUser);
        };
        
        // Fungsi untuk update counter staff yang sedang keluar
        const updateCounters = () => {
            const kasirOut = currentlyOut.filter(s => s.position === 'kasir').length;
            const csOut = currentlyOut.filter(s => s.position === 'cs').length;
            const khemerOut = currentlyOut.filter(s => s.position === 'khemer').length;
            const kaptenOut = currentlyOut.filter(s => s.position === 'kapten').length;
            
            document.getElementById('counter-kasir').textContent = kasirOut;
            document.getElementById('counter-cs').textContent = csOut;
            document.getElementById('counter-khemer').textContent = khemerOut;
            document.getElementById('counter-kapten').textContent = kaptenOut;
        };
        
        // Fungsi untuk update jam dan tanggal
        function updateClock() {
            const now = new Date();
            const options = { timeZone: 'Asia/Jakarta', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            const timeString = now.toLocaleTimeString('id-ID', options);
            document.getElementById('time').textContent = timeString;
            
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateString = now.toLocaleDateString('id-ID', dateOptions);
            document.getElementById('date').textContent = dateString;
            
            // Update setiap detik
            setTimeout(updateClock, 1000);
        }
        
        // Fungsi login
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorElement = document.getElementById('login-error');
            
            errorElement.textContent = '';
            
            const user = staffData.find(staff => 
                staff.username === username && 
                staff.password === password && 
                staff.isActive
            );
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                document.getElementById('login-page').classList.add('hidden');
                document.getElementById('main-page').classList.remove('hidden');
                
                // Update profil pengguna
                document.getElementById('profile-name').textContent = `Nama: ${user.name}`;
                document.getElementById('profile-position').textContent = `Posisi: ${getPositionName(user.position)}`;
                
                // Jika admin, tampilkan panel admin
                if (user.position === 'admin') {
                    document.getElementById('admin-panel').classList.remove('hidden');
                    renderStaffList();
                    renderExitRecords();
                } else {
                    document.getElementById('admin-panel').classList.add('hidden');
                }
                
                updateCurrentlyOutList();
                checkExitButtonStatus();
                updateCounters();
                saveData();
            } else {
                errorElement.textContent = 'Username atau password salah!';
            }
        }
        
        // Fungsi logout
        function logout() {
            localStorage.removeItem('currentUser');
            currentUser = null;
            document.getElementById('main-page').classList.add('hidden');
            document.getElementById('login-page').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('login-error').textContent = '';
        }
        
        // Fungsi untuk menampilkan staff yang sedang keluar
        function updateCurrentlyOutList() {
            const container = document.getElementById('staff-out-container');
            container.innerHTML = '';
            
            if (currentlyOut.length === 0) {
                container.innerHTML = '<p>Tidak ada staff yang sedang keluar</p>';
                return;
            }
            
            currentlyOut.forEach(staff => {
                const staffCard = document.createElement('div');
                staffCard.className = 'staff-card';
                
                const now = new Date();
                const exitTime = new Date(staff.exitTime);
                const timeDiff = now - exitTime;
                const minutesOut = Math.floor(timeDiff / (1000 * 60));
                
                staffCard.innerHTML = `
                    <div class="staff-name">${staff.name}</div>
                    <div class="staff-position">${getPositionName(staff.position)}</div>
                    <div class="staff-time">Keluar: ${formatTime(staff.exitTime)} (${minutesOut} menit lalu)</div>
                `;
                
                container.appendChild(staffCard);
            });
        }
        
        // Fungsi untuk mendapatkan nama posisi
        function getPositionName(position) {
            const positions = {
                'kasir': 'Kasir',
                'cs': 'Customer Service',
                'kapten': 'Kapten',
                'khemer': 'Khemer',
                'admin': 'Admin'
            };
            return positions[position] || position;
        }
        
        // Fungsi untuk memformat waktu
        function formatTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', timeZone: 'Asia/Jakarta' });
        }
        
        // Fungsi untuk meminta izin keluar
        function requestExit() {
            if (!currentUser) return;
            
            // Cek apakah user sudah keluar
            const alreadyOut = currentlyOut.some(staff => staff.id === currentUser.id);
            if (alreadyOut) {
                alert('Anda sudah dalam status keluar!');
                return;
            }
            
            // Tambahkan ke daftar yang sedang keluar
            currentlyOut.push({
                id: currentUser.id,
                name: currentUser.name,
                position: currentUser.position,
                exitTime: new Date().toISOString()
            });
            
            // Tambahkan ke riwayat
            exitRecords.push({
                id: Date.now(),
                staffId: currentUser.id,
                staffName: currentUser.name,
                staffPosition: currentUser.position,
                exitTime: new Date().toISOString(),
                entryTime: null,
                duration: null
            });
            
            updateCurrentlyOutList();
            checkExitButtonStatus();
            updateCounters();
            saveData();
            
            alert('Izin keluar dicatat. Durasi maksimal 15 menit.');
        }
        
        // Fungsi untuk mencatat kembali masuk
        function recordEntry() {
            if (!currentUser) return;
            
            // Cari staff yang sedang keluar
            const staffIndex = currentlyOut.findIndex(staff => staff.id === currentUser.id);
            
            if (staffIndex === -1) {
                alert('Anda tidak dalam status keluar!');
                return;
            }
            
            // Hapus dari daftar yang sedang keluar
            currentlyOut.splice(staffIndex, 1);
            
            // Update riwayat
            const now = new Date();
            const latestExit = exitRecords.filter(record => record.staffId === currentUser.id && record.entryTime === null)
                                        .sort((a, b) => new Date(b.exitTime) - new Date(a.exitTime))[0];
            
            if (latestExit) {
                latestExit.entryTime = now.toISOString();
                const exitTime = new Date(latestExit.exitTime);
                latestExit.duration = Math.floor((now - exitTime) / (1000 * 60)); // dalam menit
            }
            
            updateCurrentlyOutList();
            checkExitButtonStatus();
            updateCounters();
            saveData();
            
            if (currentUser.position === 'admin') {
                renderExitRecords();
            }
            
            alert('Izin masuk dicatat. Selamat bekerja kembali!');
        }
        
        // Fungsi untuk mengecek status tombol izin keluar
        function checkExitButtonStatus() {
            if (!currentUser) return;
            
            const exitBtn = document.getElementById('exit-btn');
            const enterBtn = document.getElementById('enter-btn');
            
            // Cek apakah user sudah keluar
            const isOut = currentlyOut.some(staff => staff.id === currentUser.id);
            
            if (isOut) {
                exitBtn.disabled = true;
                enterBtn.disabled = false;
            } else {
                exitBtn.disabled = false;
                enterBtn.disabled = true;
                
                // Cek kuota berdasarkan posisi
                const position = currentUser.position;
                const currentOutCount = currentlyOut.filter(staff => staff.position === position).length;
                
                if (position === 'kasir' && currentOutCount >= 3) {
                    exitBtn.disabled = true;
                    exitBtn.title = 'Kuota izin keluar untuk kasir sudah penuh (maks 3 orang)';
                } else if (position === 'cs' && currentOutCount >= 3) {
                    exitBtn.disabled = true;
                    exitBtn.title = 'Kuota izin keluar untuk CS sudah penuh (maks 3 orang)';
                } else if (position === 'khemer' && currentOutCount >= 1) {
                    exitBtn.disabled = true;
                    exitBtn.title = 'Kuota izin keluar untuk Khemer sudah penuh (maks 1 orang)';
                } else if (position === 'kapten' && currentOutCount >= 1) {
                    exitBtn.disabled = true;
                    exitBtn.title = 'Kuota izin keluar untuk Kapten sudah penuh (maks 1 orang)';
                } else {
                    exitBtn.title = '';
                }
            }
        }
        
        // Fungsi untuk admin panel - render daftar staff
        function renderStaffList() {
            const tbody = document.getElementById('staff-list');
            tbody.innerHTML = '';
            
            staffData.forEach(staff => {
                const tr = document.createElement('tr');
                
                tr.innerHTML = `
                    <td>${staff.name}</td>
                    <td>${getPositionName(staff.position)}</td>
                    <td>${staff.username}</td>
                    <td>${currentUser && currentUser.position === 'admin' ? staff.password : '*****'}</td>
                    <td><span class="status-indicator ${staff.isActive ? 'status-active' : 'status-inactive'}"></span> ${staff.isActive ? 'Aktif' : 'Nonaktif'}</td>
                    <td>
                        <button onclick="editStaff(${staff.id})">Edit</button>
                        <button onclick="toggleStaffStatus(${staff.id})">${staff.isActive ? 'Nonaktifkan' : 'Aktifkan'}</button>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }
        
        // Fungsi untuk admin panel - render riwayat izin keluar
        function renderExitRecords() {
            const tbody = document.getElementById('exit-records-list');
            tbody.innerHTML = '';
            
            // Urutkan dari yang terbaru
            const sortedRecords = [...exitRecords].sort((a, b) => new Date(b.exitTime) - new Date(a.exitTime));
            
            sortedRecords.forEach(record => {
                const tr = document.createElement('tr');
                
                tr.innerHTML = `
                    <td>${record.staffName}</td>
                    <td>${getPositionName(record.staffPosition)}</td>
                    <td>${formatDateTime(record.exitTime)}</td>
                    <td>${record.entryTime ? formatDateTime(record.entryTime) : 'Belum kembali'}</td>
                    <td>${record.duration ? `${record.duration} menit` : '-'}</td>
                `;
                
                tbody.appendChild(tr);
            });
        }
        
        // Fungsi untuk memformat tanggal dan waktu
        function formatDateTime(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleString('id-ID', { timeZone: 'Asia/Jakarta' });
        }
        
        // Fungsi untuk membuka tab di admin panel
        function openTab(tabId) {
            // Sembunyikan semua tab content
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Nonaktifkan semua tab button
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Aktifkan tab yang dipilih
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
        }
        
        // Fungsi untuk menambah staff baru (admin)
        function addStaff() {
            const name = document.getElementById('new-staff-name').value;
            const position = document.getElementById('new-staff-position').value;
            const username = document.getElementById('new-staff-username').value;
            const password = document.getElementById('new-staff-password').value;
            
            if (!name || !position || !username || !password) {
                alert('Semua field harus diisi!');
                return;
            }
            
            // Cek apakah username sudah ada
            if (staffData.some(staff => staff.username === username)) {
                alert('Username sudah digunakan!');
                return;
            }
            
            const newStaff = {
                id: Date.now(),
                name,
                position,
                username,
                password,
                isActive: true
            };
            
            staffData.push(newStaff);
            renderStaffList();
            saveData();
            
            // Reset form
            document.getElementById('new-staff-name').value = '';
            document.getElementById('new-staff-username').value = '';
            document.getElementById('new-staff-password').value = '';
            
            alert('Staff baru berhasil ditambahkan!');
        }
        
        // Fungsi untuk mengedit staff (admin)
        function editStaff(staffId) {
            const staff = staffData.find(s => s.id === staffId);
            if (!staff) return;
            
            const newName = prompt('Masukkan nama baru:', staff.name);
            if (newName === null) return;
            
            const newUsername = prompt('Masukkan username baru:', staff.username);
            if (newUsername === null) return;
            
            // Cek apakah username baru sudah digunakan oleh staff lain
            if (newUsername !== staff.username && staffData.some(s => s.username === newUsername && s.id !== staffId)) {
                alert('Username sudah digunakan oleh staff lain!');
                return;
            }
            
            const newPassword = prompt('Masukkan password baru (kosongkan jika tidak ingin mengubah):', '');
            
            staff.name = newName;
            staff.username = newUsername;
            
            if (newPassword) {
                staff.password = newPassword;
            }
            
            renderStaffList();
            saveData();
            alert('Data staff berhasil diperbarui!');
        }
        
        // Fungsi untuk mengaktifkan/nonaktifkan staff (admin)
        function toggleStaffStatus(staffId) {
            const staff = staffData.find(s => s.id === staffId);
            if (!staff) return;
            
            staff.isActive = !staff.isActive;
            renderStaffList();
            saveData();
            
            alert(`Staff ${staff.name} telah ${staff.isActive ? 'diaktifkan' : 'dinonaktifkan'}!`);
        }
        
        // Fungsi untuk menampilkan form ganti password
        function showChangePasswordForm() {
            document.getElementById('change-password-form').classList.remove('hidden');
        }
        
        // Fungsi untuk menyembunyikan form ganti password
        function hideChangePasswordForm() {
            document.getElementById('change-password-form').classList.add('hidden');
            document.getElementById('current-password').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-password').value = '';
            document.getElementById('password-change-error').textContent = '';
        }
        
        // Fungsi untuk mengganti password
        function changePassword() {
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            const errorElement = document.getElementById('password-change-error');
            
            errorElement.textContent = '';
            
            if (!currentUser) {
                errorElement.textContent = 'Anda belum login!';
                return;
            }
            
            if (currentUser.password !== currentPassword) {
                errorElement.textContent = 'Password saat ini salah!';
                return;
            }
            
            if (newPassword !== confirmPassword) {
                errorElement.textContent = 'Password baru tidak cocok!';
                return;
            }
            
            if (newPassword.length < 3) {
                errorElement.textContent = 'Password minimal 3 karakter!';
                return;
            }
            
            // Update password
            const userIndex = staffData.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                staffData[userIndex].password = newPassword;
                currentUser.password = newPassword;
                saveData();
                hideChangePasswordForm();
                alert('Password berhasil diubah!');
            } else {
                errorElement.textContent = 'Gagal mengubah password!';
            }
        }
        
        // Inisialisasi
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateClock();
            
            // Cek apakah ada user yang sudah login
            if (currentUser) {
                document.getElementById('login-page').classList.add('hidden');
                document.getElementById('main-page').classList.remove('hidden');
                
                // Update profil pengguna
                document.getElementById('profile-name').textContent = `Nama: ${currentUser.name}`;
                document.getElementById('profile-position').textContent = `Posisi: ${getPositionName(currentUser.position)}`;
                
                // Jika admin, tampilkan panel admin
                if (currentUser.position === 'admin') {
                    document.getElementById('admin-panel').classList.remove('hidden');
                    renderStaffList();
                    renderExitRecords();
                }
                
                updateCurrentlyOutList();
                checkExitButtonStatus();
                updateCounters();
            } else {
                // Kosongkan form login
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
            }
        });
    </script>
</body>
</html>
